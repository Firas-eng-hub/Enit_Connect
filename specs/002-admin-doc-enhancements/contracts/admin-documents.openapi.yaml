openapi: 3.0.3
info:
  title: Admin Document Enhancements API
  version: 1.0.0
servers:
  - url: /api
paths:
  /admin/documents/folders:
    post:
      summary: Create a folder
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateFolderRequest'
      responses:
        '201':
          description: Folder created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Document'
  /admin/documents/folders/{id}:
    patch:
      summary: Rename a folder
      parameters:
        - $ref: '#/components/parameters/DocumentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RenameFolderRequest'
      responses:
        '200':
          description: Folder updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Document'
    delete:
      summary: Delete a folder (only if empty)
      parameters:
        - $ref: '#/components/parameters/DocumentId'
      responses:
        '204':
          description: Folder deleted
        '409':
          description: Folder not empty
  /admin/documents/bulk-delete:
    post:
      summary: Bulk delete documents
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkIdsRequest'
      responses:
        '200':
          description: Bulk delete result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkActionResult'
  /admin/documents/bulk-move:
    post:
      summary: Bulk move documents
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkMoveRequest'
      responses:
        '200':
          description: Bulk move result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkActionResult'
  /admin/documents/bulk-download:
    post:
      summary: Bulk download documents as ZIP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkIdsRequest'
      responses:
        '200':
          description: ZIP archive
          content:
            application/zip:
              schema:
                type: string
                format: binary
  /admin/documents/{id}/share:
    post:
      summary: Create a share link
      parameters:
        - $ref: '#/components/parameters/DocumentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateShareRequest'
      responses:
        '201':
          description: Share link created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ShareLink'
  /admin/documents/{id}/shares:
    get:
      summary: List share links
      parameters:
        - $ref: '#/components/parameters/DocumentId'
      responses:
        '200':
          description: Share links
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ShareLink'
  /admin/documents/shares/{shareId}/revoke:
    patch:
      summary: Revoke a share link
      parameters:
        - name: shareId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Share revoked
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ShareLink'
  /admin/documents/{id}/versions:
    get:
      summary: List document versions
      parameters:
        - $ref: '#/components/parameters/DocumentId'
      responses:
        '200':
          description: Document versions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DocumentVersion'
  /admin/documents/{id}/versions/{versionId}/restore:
    post:
      summary: Restore a document version
      parameters:
        - $ref: '#/components/parameters/DocumentId'
        - name: versionId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Restored document
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Document'
components:
  parameters:
    DocumentId:
      name: id
      in: path
      required: true
      schema:
        type: string
  schemas:
    Document:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        description:
          type: string
          nullable: true
        category:
          type: string
          nullable: true
        tags:
          type: array
          items:
            type: string
        type:
          type: string
        emplacement:
          type: string
        link:
          type: string
          nullable: true
        version:
          type: integer
        accessLevel:
          type: string
        updatedAt:
          type: string
          format: date-time
    DocumentVersion:
      type: object
      properties:
        id:
          type: string
        documentId:
          type: string
        version:
          type: integer
        link:
          type: string
        extension:
          type: string
          nullable: true
        mimeType:
          type: string
          nullable: true
        sizeBytes:
          type: integer
          nullable: true
        createdAt:
          type: string
          format: date-time
    ShareLink:
      type: object
      properties:
        id:
          type: string
        documentId:
          type: string
        shareUrl:
          type: string
        expiresAt:
          type: string
          format: date-time
          nullable: true
        revokedAt:
          type: string
          format: date-time
          nullable: true
        requiresLogin:
          type: boolean
        audience:
          type: string
          description: students | companies | internal
    CreateFolderRequest:
      type: object
      required: [title]
      properties:
        title:
          type: string
        parentPath:
          type: string
          description: Folder path (root if omitted)
    RenameFolderRequest:
      type: object
      required: [title]
      properties:
        title:
          type: string
        updatedAt:
          type: string
          format: date-time
          nullable: true
    BulkIdsRequest:
      type: object
      required: [ids]
      properties:
        ids:
          type: array
          items:
            type: string
    BulkMoveRequest:
      type: object
      required: [ids, targetPath]
      properties:
        ids:
          type: array
          items:
            type: string
        targetPath:
          type: string
    BulkActionResult:
      type: object
      properties:
        successIds:
          type: array
          items:
            type: string
        failedIds:
          type: array
          items:
            type: string
        message:
          type: string
    CreateShareRequest:
      type: object
      properties:
        expiresInDays:
          type: integer
          default: 7
        audience:
          type: string
          description: students | companies | internal
